---
import Toast from './ui/Toast.astro';

interface Props {
  formspreeEndpoint: string;
}

const { formspreeEndpoint } = Astro.props;
---

<form
  id="contact-form"
  class="contact-form bg-white/[0.03] backdrop-blur-xl border border-white/10 rounded-lg p-8 border-t-white/20"
  action={formspreeEndpoint}
  method="POST"
>
  <h2 class="mb-6 text-2xl font-serif font-bold text-slate-100">
    Send a Message
  </h2>
  
  <div class="mb-5">
    <label for="name" class="mb-2 block text-sm font-medium text-zinc-300 font-sans">
      Name
    </label>
    <input
      type="text"
      id="name"
      name="name"
      required
      class="w-full bg-white/5 border border-white/10 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-white/15 focus:ring-1 focus:ring-white/15 transition-all duration-300 font-sans placeholder:text-gray-500"
      placeholder="Your name"
    />
  </div>
  
  <div class="mb-5">
    <label for="email" class="mb-2 block text-sm font-medium text-zinc-300 font-sans">
      Email
    </label>
    <input
      type="email"
      id="email"
      name="email"
      required
      class="w-full bg-white/5 border border-white/10 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-white/15 focus:ring-1 focus:ring-white/15 transition-all duration-300 font-sans placeholder:text-gray-500"
      placeholder="your.email@example.com"
    />
  </div>
  
  <div class="mb-6">
    <label for="message" class="mb-2 block text-sm font-medium text-zinc-300 font-sans">
      Message
    </label>
    <textarea
      id="message"
      name="message"
      rows="6"
      required
      class="w-full bg-white/5 border border-white/10 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-white/15 focus:ring-1 focus:ring-white/15 transition-all duration-300 font-sans resize-none placeholder:text-gray-500"
      placeholder="Tell me about your project or how we can collaborate..."
    ></textarea>
  </div>
  
  <button
    type="submit"
    id="submit-btn"
    class="w-full border border-white/20 text-white px-6 py-3 font-medium rounded-lg transition-all duration-300 hover:bg-white/10 hover:border-white/30 hover:text-white font-sans"
  >
    Send Message
  </button>
  
  <input type="hidden" name="_subject" value="New Contact Form Submission" />
  <input type="text" name="_gotcha" style="display:none" tabindex="-1" autocomplete="off" />
</form>

<!-- Toast Notification -->
<div
  id="toast"
  class="toast fixed bottom-24 right-8 z-[60] px-6 py-4 rounded-lg bg-[#0f172a]/90 backdrop-blur-xl border border-white/20 shadow-2xl shadow-black/50 transition-all duration-300 opacity-0 translate-y-4 pointer-events-none"
  role="alert"
  aria-live="polite"
>
  <p class="text-sm font-medium text-slate-100 font-sans">Message sent! I'll get back to you on LinkedIn.</p>
</div>

<script>
  const form = document.getElementById('contact-form') as HTMLFormElement;
  const toast = document.getElementById('toast');
  const submitBtn = document.getElementById('submit-btn') as HTMLButtonElement;

  form?.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    // Disable submit button
    submitBtn.disabled = true;
    submitBtn.textContent = 'Sending...';
    
    // Simulate delay (1 second)
    await new Promise(resolve => setTimeout(resolve, 1000));
    
    // Show toast
    toast?.classList.remove('opacity-0', 'translate-y-4', 'pointer-events-none');
    toast?.classList.add('opacity-100', 'translate-y-0');
    
    // Clear form
    form.reset();
    
    // Re-enable submit button
    submitBtn.disabled = false;
    submitBtn.textContent = 'Send Message';
    
    // Hide toast after 4 seconds
    setTimeout(() => {
      toast?.classList.remove('opacity-100', 'translate-y-0');
      toast?.classList.add('opacity-0', 'translate-y-4', 'pointer-events-none');
    }, 4000);
    
    // Submit form to Formspree (in background)
    const formData = new FormData(form);
    fetch(form.action, {
      method: 'POST',
      body: formData,
    }).catch(() => {
      // Silent fail - user already sees success message
    });
  });
</script>

<style>
  .toast {
    backdrop-filter: blur(40px);
    -webkit-backdrop-filter: blur(40px);
  }
  
  @media (max-width: 640px) {
    .toast {
      bottom: 5rem;
      right: 1rem;
      left: 1rem;
    }
  }

  /* Override browser autofill styles to keep it neutral */
  input:-webkit-autofill,
  input:-webkit-autofill:hover,
  input:-webkit-autofill:focus,
  input:-webkit-autofill:active,
  textarea:-webkit-autofill,
  textarea:-webkit-autofill:hover,
  textarea:-webkit-autofill:focus,
  textarea:-webkit-autofill:active {
    -webkit-box-shadow: 0 0 0 30px rgba(255, 255, 255, 0.05) inset !important;
    -webkit-text-fill-color: rgba(255, 255, 255, 0.9) !important;
    background-color: rgba(255, 255, 255, 0.05) !important;
    border-color: rgba(255, 255, 255, 0.1) !important;
    transition: background-color 5000s ease-in-out 0s;
  }

  /* Firefox autofill */
  input:-moz-autofill,
  textarea:-moz-autofill {
    background-color: rgba(255, 255, 255, 0.05) !important;
    color: rgba(255, 255, 255, 0.9) !important;
  }
</style>

