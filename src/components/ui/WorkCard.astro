---
import type { WorkItem } from '../../data/work';
import { ExternalLink, FileText, Eye } from 'lucide-react';

interface Props {
  workItem: WorkItem;
}

const { workItem } = Astro.props;

const getActionIcon = (actionType: string) => {
  if (actionType === 'pdf') return FileText;
  if (actionType === 'drive') return Eye;
  return ExternalLink;
};

const categoryColors = {
  shipped: 'bg-green-500/20 text-green-300 border-green-500/40',
  professional: 'bg-blue-500/20 text-blue-300 border-blue-500/40',
  'case-study': 'bg-purple-500/20 text-purple-300 border-purple-500/40',
};
---

<div class="work-card group relative rounded-lg p-6 flex flex-col justify-between overflow-hidden cursor-pointer transition-all duration-300 ease-out glass-card">
  <div class="flex-1 flex flex-col relative z-10">
    <!-- Header -->
    <div class="mb-4">
      <h3 class="text-xl md:text-2xl font-serif font-bold text-slate-100 group-hover:text-white transition-colors mb-2 group-hover:drop-shadow-[0_0_8px_rgba(255,255,255,0.5)]">
        {workItem.title}
      </h3>
      <p class="text-sm text-zinc-300 line-clamp-2 leading-relaxed font-sans">
        {workItem.description}
      </p>
    </div>

    <!-- Tags -->
    {workItem.tags && workItem.tags.length > 0 && (
      <div class="flex flex-wrap gap-2 mb-4">
        {workItem.tags.map((tag) => (
          <span
            class="px-2.5 py-1 text-xs font-mono font-medium bg-zinc-950/50 border border-zinc-800/50 rounded text-zinc-500"
            title={tag}
          >
            {tag}
          </span>
        ))}
      </div>
    )}
  </div>

  <!-- Footer -->
  <div class="flex items-center justify-between mt-auto pt-4 border-t border-zinc-800/50 relative z-10">
    <span
      class={`px-3 py-1 rounded-full text-xs font-mono font-medium border ${categoryColors[workItem.category]}`}
    >
      {workItem.category === 'shipped' ? 'Shipped' : workItem.category === 'professional' ? 'Professional' : 'Case Study'}
    </span>
    {workItem.actionUrl && workItem.actionUrl !== '#' && (
      workItem.actionType === 'drive' && workItem.driveFileId ? (
        <button
          data-drive-file-id={workItem.driveFileId}
          data-drive-title={workItem.title}
          class="glass-button drive-viewer-button text-xs text-white font-mono font-medium z-10 relative flex items-center gap-1.5 px-3 py-1.5 rounded border border-white/20 bg-black/20 backdrop-blur-sm hover:bg-black/30 hover:border-white/30 transition-all cursor-pointer"
        >
          {(() => {
            const ActionIcon = getActionIcon(workItem.actionType);
            return <ActionIcon class="w-3 h-3" />;
          })()}
          {workItem.actionLabel}
        </button>
      ) : (
        <a
          href={workItem.actionUrl}
          target="_blank"
          rel="noopener noreferrer"
          class="glass-button text-xs text-white font-mono font-medium z-10 relative flex items-center gap-1.5 px-3 py-1.5 rounded border border-white/20 bg-black/20 backdrop-blur-sm hover:bg-black/30 hover:border-white/30 transition-all"
        >
          {(() => {
            const ActionIcon = getActionIcon(workItem.actionType);
            return <ActionIcon class="w-3 h-3" />;
          })()}
          {workItem.actionLabel}
        </a>
      )
    )}
    {(!workItem.actionUrl || workItem.actionUrl === '#') && (
      <span class="text-xs text-zinc-500 font-mono font-medium">
        {workItem.actionLabel}
      </span>
    )}
  </div>
</div>

<style>
  /* Glassmorphism Style - Matching Project Cards */
  .glass-card {
    background: rgba(255, 255, 255, 0.02);
    backdrop-filter: blur(5px);
    -webkit-backdrop-filter: blur(5px);
    border: 1px solid rgba(255, 255, 255, 0.1);
  }

  /* Hover Effect - Lift up slightly */
  .work-card {
    transition: all 0.3s ease-out;
  }

  .work-card:hover {
    transform: translateY(-4px);
    border-color: rgba(255, 255, 255, 0.3);
    box-shadow: 0 8px 24px rgba(255, 255, 255, 0.15);
    background: rgba(255, 255, 255, 0.05);
  }

  /* Glassmorphism Buttons */
  .glass-button {
    transition: all 0.3s ease-out;
  }

  .glass-button:hover {
    box-shadow: 0 0 15px rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.5);
    text-shadow: 0 0 8px rgba(255, 255, 255, 0.6);
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    // Handle Drive Viewer button clicks
    document.querySelectorAll('.drive-viewer-button').forEach((button) => {
      button.addEventListener('click', (e) => {
        e.preventDefault();
        e.stopPropagation();
        
        const fileId = button.getAttribute('data-drive-file-id');
        const title = button.getAttribute('data-drive-title') || 'Document Viewer';
        
        if (fileId && typeof window !== 'undefined' && window.openDriveViewer) {
          window.openDriveViewer(fileId, title);
        }
      });
    });
  });
</script>


