---
import type { Project } from '../../domains/projects/entities';
import { ExternalLink, Play } from 'lucide-react';

interface Props {
  project: Project;
  size?: 'large' | 'medium' | 'small';
}

const { project, size = 'medium' } = Astro.props;

// Dynamic CTA label and icon based on status
const getCTALabel = (status: string) => {
  if (status === 'Live Product') return 'Visit Website';
  if (status === 'Prototype') return 'View Demo';
  if (status === 'Founded') return 'View Archive';
  return 'Live Demo'; // fallback
};

const getCTAIcon = (status: string) => {
  if (status === 'Prototype') return Play;
  return ExternalLink; // Live Product, Founded, and fallback
};

const sizeClasses = {
  large: 'col-span-1 md:col-span-2 lg:col-span-2 row-span-1 md:row-span-2',
  medium: 'col-span-1 row-span-1',
  small: 'col-span-1 row-span-1',
};

const statusColors = {
  Prototype: 'bg-purple-500/20 text-purple-300 border-purple-500/40',
  'Live Product': 'bg-green-500/20 text-green-300 border-green-500/40',
  Founded: 'bg-zinc-800/40 text-zinc-200 border-zinc-700/50',
  Live: 'bg-green-500/20 text-green-300 border-green-500/40',
  'Case Study': 'bg-zinc-800/40 text-zinc-200 border-zinc-700/50',
  'Stealth Mode': 'bg-zinc-800/40 text-zinc-200 border-zinc-700/50',
  Startup: 'bg-zinc-800/40 text-zinc-200 border-zinc-700/50',
};
---

<div
  class={`project-card group relative ${sizeClasses[size]} rounded-lg p-6 flex flex-col justify-between overflow-hidden cursor-pointer transition-all duration-300 ease-out ${
    size === 'large' && project.slug === 'raitalk'
      ? 'neural-wave-card'
      : 'glass-card'
  }`}
  data-project-slug={project.slug}
>
  <!-- Neural Wave Animation for RaiTalk Card -->
  {size === 'large' && project.slug === 'raitalk' && (
    <div class="neural-wave-container absolute inset-0 pointer-events-none z-0">
      <svg class="neural-wave-svg" viewBox="0 0 1200 300" preserveAspectRatio="xMidYMax slice">
        <defs>
          <linearGradient id="waveGradient1" x1="0%" y1="0%" x2="100%" y2="0%">
            <stop offset="0%" style="stop-color:rgba(255,255,255,0.3);stop-opacity:0" />
            <stop offset="50%" style="stop-color:rgba(255,255,255,0.3);stop-opacity:1" />
            <stop offset="100%" style="stop-color:rgba(255,255,255,0.3);stop-opacity:0" />
          </linearGradient>
          <linearGradient id="waveGradient2" x1="0%" y1="0%" x2="100%" y2="0%">
            <stop offset="0%" style="stop-color:rgba(255,255,255,0.25);stop-opacity:0" />
            <stop offset="50%" style="stop-color:rgba(255,255,255,0.25);stop-opacity:1" />
            <stop offset="100%" style="stop-color:rgba(255,255,255,0.25);stop-opacity:0" />
          </linearGradient>
        </defs>
        <!-- Sine wave paths - multiple layers for depth -->
        <path
          class="neural-wave neural-wave-1"
          d="M 0,150 Q 150,100 300,150 T 600,150 T 900,150 T 1200,150"
          fill="none"
          stroke="url(#waveGradient1)"
          stroke-width="1"
        />
        <path
          class="neural-wave neural-wave-2"
          d="M 0,170 Q 150,120 300,170 T 600,170 T 900,170 T 1200,170"
          fill="none"
          stroke="url(#waveGradient2)"
          stroke-width="0.8"
        />
        <path
          class="neural-wave neural-wave-3"
          d="M 0,190 Q 150,140 300,190 T 600,190 T 900,190 T 1200,190"
          fill="none"
          stroke="url(#waveGradient2)"
          stroke-width="0.6"
        />
        <path
          class="neural-wave neural-wave-4"
          d="M 0,130 Q 150,80 300,130 T 600,130 T 900,130 T 1200,130"
          fill="none"
          stroke="url(#waveGradient1)"
          stroke-width="0.5"
        />
      </svg>
    </div>
  )}
  <div class="flex-1 flex flex-col relative z-10">
    <!-- Header -->
    <div class="mb-4">
      {project.slug === 'raitalk' ? (
        <!-- Special RaiTalk Layout -->
        <div class="space-y-1 relative z-10">
          <h3 class="text-xl md:text-2xl font-serif font-bold text-white group-hover:text-white transition-colors group-hover:drop-shadow-[0_0_8px_rgba(255,255,255,0.5)]">
            {project.title}
          </h3>
          <p class="text-base font-sans font-semibold text-zinc-200">
            {project.description}
          </p>
        </div>
      ) : (
        <!-- Default Layout for Other Projects -->
        <>
          <h3 class="text-xl md:text-2xl font-serif font-bold text-slate-100 group-hover:text-white transition-colors mb-2 group-hover:drop-shadow-[0_0_8px_rgba(255,255,255,0.5)]">
            {project.title}
          </h3>
          <p class="text-sm text-zinc-300 line-clamp-3 leading-relaxed font-sans">
            {project.description}
          </p>
        </>
      )}
    </div>

    <!-- Tech Stack (Builder Metadata - Monospace) -->
    {project.techStack && project.techStack.length > 0 && (
      <div class="flex flex-wrap gap-2 mb-4">
        {project.techStack.slice(0, 4).map((tech) => (
          <span
            class="px-2.5 py-1 text-xs font-mono font-medium bg-zinc-950/50 border border-zinc-800/50 rounded text-zinc-500"
            title={tech}
          >
            {tech}
          </span>
        ))}
        {project.techStack.length > 4 && (
          <span class="px-2.5 py-1 text-xs font-mono font-medium bg-zinc-950/50 border border-zinc-800/50 rounded text-zinc-600">
            +{project.techStack.length - 4}
          </span>
        )}
      </div>
    )}
  </div>

  <!-- Footer -->
  <div class="flex items-center justify-between mt-auto pt-4 border-t border-zinc-800/50 relative z-10">
    <span
      class={`px-3 py-1 rounded-full text-xs font-mono font-medium border ${statusColors[project.status]}`}
    >
      {project.status}
    </span>
    <div class="flex items-center gap-3">
      {project.demoUrl && (() => {
        const CTALabel = getCTALabel(project.status);
        const CTAIcon = getCTAIcon(project.status);
        return (
          <a
            href={project.demoUrl}
            target="_blank"
            rel="noopener noreferrer"
            class="glass-button text-xs text-white font-mono font-medium z-10 relative flex items-center gap-1.5 px-3 py-1.5 rounded border border-white/20 bg-black/20 backdrop-blur-sm hover:bg-black/30 hover:border-white/30 transition-all"
          >
            <CTAIcon class="w-3 h-3" />
            {CTALabel}
          </a>
        );
      })()}
      {project.repoUrl && (
        <a
          href={project.repoUrl}
          target="_blank"
          rel="noopener noreferrer"
          class="glass-button text-xs text-white font-mono font-medium z-10 relative px-3 py-1.5 rounded border border-white/20 bg-black/20 backdrop-blur-sm hover:bg-black/30 hover:border-white/30 transition-all"
        >
          Code
        </a>
      )}
    </div>
  </div>
</div>

<style>
  /* Glassmorphism Style - Matching Recent Writing */
  .glass-card,
  .neural-wave-card {
    background: rgba(255, 255, 255, 0.02);
    backdrop-filter: blur(5px);
    -webkit-backdrop-filter: blur(5px);
    border: 1px solid rgba(255, 255, 255, 0.1);
  }

  /* Neural Wave Card - Special styling for RaiTalk */
  .neural-wave-card {
    position: relative;
  }

  /* Neural Wave Animation Container */
  .neural-wave-container {
    overflow: hidden;
    bottom: 0;
    height: 50%;
  }

  .neural-wave-svg {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 100%;
    opacity: 0.3;
  }

  /* Neural Wave Animation - Slow horizontal flow (like audio visualizer/brain frequency) */
  @keyframes waveFlow {
    0% {
      transform: translateX(-100%);
    }
    100% {
      transform: translateX(100%);
    }
  }

  .neural-wave {
    animation: waveFlow linear infinite;
  }

  .neural-wave-1 {
    animation-duration: 15s;
    animation-delay: 0s;
  }

  .neural-wave-2 {
    animation-duration: 18s;
    animation-delay: 3s;
  }

  .neural-wave-3 {
    animation-duration: 20s;
    animation-delay: 6s;
  }

  .neural-wave-4 {
    animation-duration: 16s;
    animation-delay: 1.5s;
  }

  /* White Glow Hover Effect for Cards - Border brightness increases */
  .project-card {
    transition: all 0.3s ease-out;
  }

  .project-card:hover {
    border-color: rgba(255, 255, 255, 0.3);
    box-shadow: 0 0 15px rgba(255, 255, 255, 0.2);
  }

  /* Glassmorphism Buttons */
  .glass-button {
    transition: all 0.3s ease-out;
  }

  .glass-button:hover {
    box-shadow: 0 0 15px rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.5);
    text-shadow: 0 0 8px rgba(255, 255, 255, 0.6);
  }

  /* Text Links Hover */
  .project-card a:not(.glass-button) {
    color: #888;
    transition: all 0.3s ease-out;
  }

  .project-card a:not(.glass-button):hover {
    color: #fff;
    text-shadow: 0 0 8px rgba(255, 255, 255, 0.6);
  }
</style>

<script define:vars={{ projectSlug: project.slug }}>
  // Track Clarity events
  function trackEvent(eventName) {
    if (typeof window !== 'undefined' && window.clarity) {
      window.clarity('event', eventName);
    }
  }

  // Make entire card clickable except for demo/repo links
  document.querySelectorAll(`.project-card[data-project-slug="${projectSlug}"]`).forEach((card) => {
    const slug = card.dataset.projectSlug;
    const slugFormatted = slug.charAt(0).toUpperCase() + slug.slice(1).replace(/-/g, '_');
    
    // Track project card hover
    let hoverTracked = false;
    card.addEventListener('mouseenter', () => {
      if (!hoverTracked) {
        trackEvent(`Project_Card_Hover_${slugFormatted}`);
        hoverTracked = true;
      }
    });
    
    // Track project-specific button clicks
    const demoButton = card.querySelector('a.glass-button[target="_blank"]');
    const codeButton = card.querySelector('a.glass-button[href*="github"], a.glass-button[href*="git"]');
    
    if (demoButton) {
      demoButton.addEventListener('click', (e) => {
        e.stopPropagation();
        if (slug === 'raitalk') {
          trackEvent('Click_RaiTalk_Demo');
        } else if (slug === 'trinka') {
          trackEvent('Click_Trinka_Proto');
        } else if (slug === 'madhav-farm') {
          trackEvent('Click_MadhavFarm_Case');
        } else {
          trackEvent(`Project_Demo_Click_${slugFormatted}`);
        }
      });
    }
    
    if (codeButton) {
      codeButton.addEventListener('click', (e) => {
        e.stopPropagation();
        trackEvent(`Project_Code_Click_${slugFormatted}`);
      });
    }
    
    card.addEventListener('click', (e) => {
      // Don't navigate if clicking on external links
      if (e.target.closest('a[target="_blank"]')) {
        return;
      }
      // Track card click
      trackEvent(`Project_Card_Click_${slugFormatted}`);
      // Navigate to project detail page
      if (slug) {
        window.location.href = `/projects/${slug}`;
      }
    });
  });
</script>

