---
import type { CollectionEntry } from "astro:content";

interface Props {
  project: CollectionEntry<"work">;
  size?: "large" | "medium" | "small";
  hideSecondaryLink?: boolean;
}

const {
  project: workItem,
  size = "medium",
  hideSecondaryLink = false,
} = Astro.props;
const project = workItem.data;
const { tags, metric } = project;
const slug = workItem.slug;

const titleClass = size === "large" ? "text-4xl md:text-5xl" : "text-3xl";
---

<div
  class="group relative flex flex-col w-full h-full overflow-hidden rounded-3xl border border-white/5 bg-zinc-950/50 backdrop-blur-md transition-all duration-500 hover:border-white/20 hover:bg-zinc-900/80 p-8 md:p-10 cursor-pointer"
>
  <a
    href={`/work/${slug}`}
    class="absolute inset-0 z-0"
    aria-label={`View ${project.title} case study`}></a>

  <div class="mb-6 relative z-10 pointer-events-none">
    <h3 class={`font-serif text-slate-100 mb-3 ${titleClass}`}>
      {project.title}
    </h3>

    {
      metric && (
        <div class="flex items-center text-sm font-bold tracking-wide text-emerald-400 uppercase">
          <span class="mr-2">✦</span>
          {metric}
        </div>
      )
    }
  </div>

  <p
    class="flex-grow text-zinc-400 leading-relaxed text-base md:text-lg mb-8 relative z-10 pointer-events-none"
  >
    {project.description}
  </p>

  <!-- Footer with tags on left, actions on right -->
  <div class="mt-auto pt-6 border-t border-white/5 relative z-10">
    <div class="flex items-start justify-between gap-4 flex-wrap">
      <!-- Tags on the left -->
      <div class="flex flex-wrap gap-2 items-center pointer-events-none">
        {
          tags && tags.length > 0 && (
            <>
              {tags.slice(0, 3).map((tag) => (
                <span class="px-2 py-1 text-[10px] font-bold tracking-wider text-zinc-400 uppercase border border-white/10 rounded-full bg-white/5 whitespace-nowrap">
                  {tag}
                </span>
              ))}
            </>
          )
        }
      </div>

      <!-- Action links on the right -->
      <div class="flex items-center gap-4 ml-auto">
        <a
          href={`/work/${slug}`}
          class="flex items-center text-sm font-medium text-white hover:text-emerald-400 transition-colors group/btn whitespace-nowrap relative z-10"
        >
          Read case
          <span
            class="ml-1 transition-transform duration-300 group-hover/btn:translate-x-1"
            >→</span
          >
        </a>

        {
          !hideSecondaryLink && (
            <>
              {project.actionUrl && (
                <>
                  {project.actionType === "pdf" ||
                  project.actionType === "drive" ? (
                    <button
                      type="button"
                      data-pdf-url={project.actionUrl}
                      data-pdf-title={project.title}
                      class="pdf-modal-trigger relative z-20 flex items-center text-sm font-medium text-zinc-500 hover:text-white transition-colors group/link whitespace-nowrap pointer-events-auto"
                    >
                      <span>{project.actionLabel || "View Document"}</span>
                      <span class="ml-1 transition-transform duration-300 group-hover/link:-translate-y-0.5 group-hover/link:translate-x-0.5">
                        ↗
                      </span>
                    </button>
                  ) : (
                    <a
                      href={project.actionUrl}
                      target="_blank"
                      rel="noopener noreferrer"
                      class="relative z-20 flex items-center text-sm font-medium text-zinc-500 hover:text-white transition-colors group/link whitespace-nowrap pointer-events-auto"
                      onclick="event.stopPropagation()"
                    >
                      <span>{project.actionLabel || "View Site"}</span>
                      <span class="ml-1 transition-transform duration-300 group-hover/link:-translate-y-0.5 group-hover/link:translate-x-0.5">
                        ↗
                      </span>
                    </a>
                  )}
                </>
              )}
            </>
          )
        }
      </div>
    </div>
  </div>
</div>
