---
import LinkedInIcon from "../icons/LinkedInIcon";

const currentPath = Astro.url.pathname;

const isActive = (path: string) => {
  if (path === "/") return currentPath === "/";
  return currentPath.startsWith(path);
};
---

<!-- Desktop Header: Split Layout (Logo Left, Menu Right) -->
<header
  id="desktop-header"
  class="desktop-header hidden md:flex fixed top-0 left-0 w-full z-50 px-8 py-6 justify-between items-center bg-transparent transition-all duration-300"
>
  <!-- Left: Brand Logo - Floating Pill -->
  <a
    href="/"
    id="desktop-logo"
    class="text-4xl font-serif tracking-tight text-white transition-all duration-300 ease-out flex items-center hover:drop-shadow-[0_0_4px_rgba(255,255,255,0.8)] px-6 py-2 rounded-full border border-white/10 bg-white/5 backdrop-blur-lg shadow-lg shadow-black/5"
  >
    <span class="font-light">Raj</span>
    <span class="font-black"> Kawale</span>
  </a>

  <!-- Right: Navigation Menu + Social Icons - Combined Floating Pill -->
  <div
    id="desktop-nav"
    class="hidden md:flex items-center gap-6 px-6 py-2 rounded-full border border-white/10 bg-white/5 backdrop-blur-lg shadow-lg shadow-black/5 transition-all duration-300"
  >
    <!-- Navigation Links -->
    <nav class="flex items-center gap-8">
      <a
        href="/"
        id="nav-home"
        class="moonlight-text-link text-base font-medium font-sans text-[#888] hover:text-white transition-all duration-300 ease-out"
      >
        Home
      </a>
      <a
        href="/work"
        id="nav-work"
        class="moonlight-text-link text-base font-medium font-sans text-[#888] hover:text-white transition-all duration-300 ease-out"
      >
        Work
      </a>
      <a
        href="/trusted-by"
        id="nav-trusted-by"
        class="moonlight-text-link text-base font-medium font-sans text-[#888] hover:text-white transition-all duration-300 ease-out"
      >
        Trusted By
      </a>
      <a
        href="/blog"
        id="nav-writing"
        class="moonlight-text-link text-base font-medium font-sans text-[#888] hover:text-white transition-all duration-300 ease-out"
      >
        Writing
      </a>
      <a
        href="/contact"
        id="nav-contact"
        class="moonlight-text-link text-base font-medium font-sans text-[#888] hover:text-white transition-all duration-300 ease-out"
      >
        Contact
      </a>
    </nav>

    <!-- Social Icons -->
    <div class="flex items-center gap-4 pl-4 border-l border-white/10">
      <a
        href="https://www.linkedin.com/in/rajkawale/"
        target="_blank"
        rel="noopener noreferrer"
        class="moonlight-text-link text-[#888] hover:text-white transition-all duration-300 ease-out flex items-center"
        aria-label="LinkedIn"
      >
        <LinkedInIcon client:load className="w-5 h-5" />
      </a>
    </div>
  </div>
</header>

<style>
  .moonlight-text-link:hover {
    text-shadow: 0 0 8px rgba(255, 255, 255, 0.6);
  }
</style>

<script>
  // Handle all navigation link active states based on scroll position and current page
  document.addEventListener("DOMContentLoaded", () => {
    const homeLink = document.getElementById("nav-home");
    const workLink = document.getElementById("nav-work");
    const trustedByLink = document.getElementById("nav-trusted-by");
    const writingLink = document.getElementById("nav-writing");
    const contactLink = document.getElementById("nav-contact");

    const projectsSection = document.getElementById("projects");
    const trustedBySection = document.getElementById("trusted-by");
    const writingSection = document.getElementById("writing");
    const currentPath = window.location.pathname;

    if (
      !homeLink ||
      !workLink ||
      !trustedByLink ||
      !writingLink ||
      !contactLink
    )
      return;

    // Type assertions: we know these are non-null after the check above
    const links = {
      home: homeLink as HTMLAnchorElement,
      work: workLink as HTMLAnchorElement,
      trustedBy: trustedByLink as HTMLAnchorElement,
      writing: writingLink as HTMLAnchorElement,
      contact: contactLink as HTMLAnchorElement,
    };

    function updateActiveStates() {
      const scrollY = window.scrollY;
      const isAtTop = scrollY < 300; // Active when near top of page

      // Reset all links first
      Object.values(links).forEach((link) => {
        link.classList.remove("text-white");
        link.classList.add("text-[#888]");
      });

      // Update Home link - only active at top of homepage
      if (isAtTop && currentPath === "/") {
        links.home.classList.add("text-white");
        links.home.classList.remove("text-[#888]");
        return; // Don't check other sections if at top
      }

      // Update Work link - active when on work page
      if (currentPath === "/work") {
        links.work.classList.add("text-white");
        links.work.classList.remove("text-[#888]");
        return;
      }

      // Also active when projects section is in view on homepage
      if (projectsSection && currentPath === "/") {
        const rect = projectsSection.getBoundingClientRect();
        const isInView = rect.top <= 200 && rect.bottom >= 200;

        if (isInView) {
          links.work.classList.add("text-white");
          links.work.classList.remove("text-[#888]");
          return;
        }
      }

      // Update Trusted By link - active when section is in view or on trusted-by page
      if (currentPath === "/trusted-by") {
        links.trustedBy.classList.add("text-white");
        links.trustedBy.classList.remove("text-[#888]");
        return;
      } else if (trustedBySection && currentPath === "/") {
        const rect = trustedBySection.getBoundingClientRect();
        const isInView = rect.top <= 200 && rect.bottom >= 200;

        if (isInView) {
          links.trustedBy.classList.add("text-white");
          links.trustedBy.classList.remove("text-[#888]");
          return;
        }
      }

      // Update Writing link - active when section is in view or on blog page
      if (currentPath === "/blog" || currentPath.startsWith("/blog/")) {
        links.writing.classList.add("text-white");
        links.writing.classList.remove("text-[#888]");
        return;
      } else if (writingSection && currentPath === "/") {
        const rect = writingSection.getBoundingClientRect();
        const isInView = rect.top <= 200 && rect.bottom >= 200;

        if (isInView) {
          links.writing.classList.add("text-white");
          links.writing.classList.remove("text-[#888]");
          return;
        }
      }

      // Update Contact link - active when on contact page
      if (currentPath === "/contact") {
        links.contact.classList.add("text-white");
        links.contact.classList.remove("text-[#888]");
      }
    }

    // Check on scroll
    window.addEventListener("scroll", updateActiveStates);

    // Check on page load (in case user lands on hash)
    if (window.location.hash) {
      setTimeout(updateActiveStates, 100);
    }

    // Check initial state
    updateActiveStates();
  });

  // Optional: Enhance pill styling on scroll (already has base styling)
  window.addEventListener("scroll", () => {
    const nav = document.getElementById("desktop-nav");
    const logo = document.getElementById("desktop-logo");
    const scrollY = window.scrollY;

    if (scrollY > 50) {
      [nav, logo].forEach((element) => {
        element?.classList.add("bg-white/8", "backdrop-blur-xl");
        element?.classList.remove("bg-white/5", "backdrop-blur-lg");
      });
    } else {
      [nav, logo].forEach((element) => {
        element?.classList.remove("bg-white/8", "backdrop-blur-xl");
        element?.classList.add("bg-white/5", "backdrop-blur-lg");
      });
    }
  });
</script>
