---
import BaseLayout from '../../components/BaseLayout.astro';
import { container } from '../../core/di/container';

export async function getStaticPaths() {
  try {
    const blogService = container.getBlogService();
    const posts = await blogService.getAllPosts();
    
    // Return empty array if no posts to prevent build errors
    if (!posts || posts.length === 0) {
      return [];
    }
    
    return posts.map((post) => ({
      params: { slug: post.slug },
      props: { post },
    }));
  } catch (error) {
    console.error('Error in getStaticPaths for blog:', error);
    return [];
  }
}

const { post } = Astro.props;

// Get full content from JSON
let fullContent = '';
try {
  const blogData = await import('../../data/external/blogger.json');
  const rawPosts = blogData.default || [];
  const rawPost = rawPosts.find((p: any) => p.slug === post.slug);
  fullContent = rawPost?.content || '';
} catch (e) {
  // Content not available
  console.error('Error loading blog content:', e);
}
---

<BaseLayout
  title={`${post.title} - Raj Kawale`}
  description={post.excerpt || post.title}
>
  <main class="min-h-screen bg-[#020617] text-zinc-300 pt-24 py-24 px-6 md:px-12 relative z-10">
    <article class="max-w-4xl mx-auto">
      <header class="mb-12 border-b border-zinc-800 pb-6">
        <h1 class="mb-4 text-4xl md:text-5xl font-serif font-bold text-slate-100">
          {post.title}
        </h1>
        <time
          datetime={post.publishedAt.toISOString()}
          class="text-sm font-mono text-zinc-500"
        >
          {post.publishedAt.toLocaleDateString('en-US', {
            year: 'numeric',
            month: 'long',
            day: 'numeric',
          })}
        </time>
      </header>
      
      <div class="prose prose-lg max-w-none prose-headings:font-serif prose-headings:text-slate-100 prose-p:text-zinc-300 prose-a:text-indigo-400 prose-a:no-underline prose-a:hover:underline">
        {fullContent ? (
          <div set:html={fullContent} />
        ) : (
          <p class="text-zinc-400 font-sans">Content loading...</p>
        )}
      </div>
      
      <footer class="mt-12 border-t border-zinc-800 pt-6">
        <a
          href="/blog"
          class="inline-block border border-white/20 bg-zinc-900/50 px-4 py-2 text-sm font-mono text-zinc-300 transition-colors hover:bg-zinc-800 hover:border-white/30 rounded"
        >
          ‚Üê Back to Blog
        </a>
      </footer>
    </article>
  </main>
</BaseLayout>

