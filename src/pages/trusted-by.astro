---
import BaseLayout from '../components/BaseLayout.astro';
import { trustedBy } from '../data/trustedBy';

// Function to get initials from name
function getInitials(name: string): string {
  const parts = name.trim().split(/\s+/);
  if (parts.length === 1) {
    return parts[0].substring(0, 2).toUpperCase();
  }
  return (parts[0][0] + parts[parts.length - 1][0]).toUpperCase();
}

// Function to convert name to URL-friendly slug
function toSlug(name: string): string {
  return name.toLowerCase().replace(/\s+/g, '-');
}
---

<BaseLayout
  title="Trusted By | Product Leaders and Teams – Raj Kawale"
  description="Perspectives from founders, product leaders, and teams who have built AI, SaaS, and consumer products with Raj Kawale."
  keywords="product manager credibility, trusted product manager, product leadership, collaboration in product teams"
>
  <main class="min-h-screen bg-[#020617] text-zinc-300 pt-24 relative z-10 pb-[120px] md:pb-16">
    <div class="max-w-6xl mx-auto px-5 md:px-12 py-16">
      <!-- Mobile Back Button -->
      <a
        href="/#trusted-by"
        class="md:hidden moonlight-text-link inline-block mb-6 text-[14px] uppercase tracking-wide font-sans opacity-70 hover:opacity-100 transition-all duration-300 ease-out"
      >
        ← Back to Home
      </a>
      
      <!-- Header -->
      <div class="mb-16 text-center">
        <h1 class="text-4xl md:text-5xl font-serif font-bold text-slate-100 mb-4">
          Trusted By<span class="text-gray-500">.</span>
        </h1>
        <p class="text-zinc-400 text-lg font-sans">
          Perspectives from people I've built products with.
        </p>
      </div>

      <!-- Masonry Layout -->
      <div class="columns-1 md:columns-2 gap-6">
        {trustedBy.map((person) => (
          <div
            id={toSlug(person.name)}
            class="moonlight-container trusted-card mb-6 break-inside-avoid bg-neutral-900/50 backdrop-blur-xl border border-white/10 rounded-lg p-6 transition-all duration-300 ease-out scroll-mt-24"
          >
            <!-- Image and Name -->
            <div class="flex items-center gap-4 mb-4">
              <div class="profile-image-container w-16 h-16 rounded-full border-2 border-white/20 flex items-center justify-center bg-gradient-to-br from-purple-500/20 to-blue-500/20 relative overflow-hidden flex-shrink-0">
                <img
                  src={person.image}
                  alt={person.name}
                  class="profile-image w-full h-full rounded-full object-cover absolute inset-0"
                  data-person-name={person.name}
                />
                <span
                  class="profile-initials text-white font-semibold text-lg hidden"
                  data-initials={getInitials(person.name)}
                >
                  {getInitials(person.name)}
                </span>
              </div>
              <div>
                <a
                  href={person.linkedin}
                  target="_blank"
                  rel="noopener noreferrer"
                  class="group moonlight-text-link text-white font-semibold text-base font-sans transition-all duration-300 ease-out inline-flex items-center gap-1.5"
                  onclick="event.stopPropagation()"
                >
                  {person.name}
                  <svg 
                    class="w-4 h-4 text-neutral-500 group-hover:text-white transition-colors" 
                    fill="none" 
                    stroke="currentColor" 
                    viewBox="0 0 24 24"
                    aria-hidden="true"
                  >
                    <path 
                      stroke-linecap="round" 
                      stroke-linejoin="round" 
                      stroke-width="2" 
                      d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"
                    />
                  </svg>
                </a>
                <p class="text-zinc-500 text-sm mt-1 font-sans">{person.role}</p>
                {person.date && (
                  <p class="text-zinc-600 text-xs font-mono mt-1">
                    {new Date(person.date).toLocaleDateString('en-US', {
                      year: 'numeric',
                      month: 'long',
                    })}
                  </p>
                )}
              </div>
            </div>

            <!-- Testimonial Text -->
            <p class="text-zinc-300 text-sm leading-relaxed font-sans">
              {person.text}
            </p>
          </div>
        ))}
      </div>
    </div>
  </main>
</BaseLayout>

<style>
  /* Moonlight Container Hover Effect */
  .moonlight-container {
    transition: all 0.3s ease-out;
  }

  .moonlight-container:hover {
    box-shadow: 0 0 15px rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
  }

  .trusted-card:hover {
    transform: translateY(-2px);
  }

  /* Moonlight Text Link Hover Effect */
  .moonlight-text-link {
    transition: all 0.3s ease-out;
  }

  .moonlight-text-link:hover {
    text-shadow: 0 0 8px rgba(255, 255, 255, 0.6);
  }

  /* Prevent breaking inside cards */
  .break-inside-avoid {
    break-inside: avoid;
    page-break-inside: avoid;
  }

  /* Mobile-specific improvements */
  @media (max-width: 640px) {
    .trusted-card {
      margin-bottom: 1rem;
    }
  }
</style>

<script>
  // Handle image load errors and show initials fallback
  document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('.profile-image').forEach((img) => {
      // Function to show initials fallback
      const showInitials = (imageElement: HTMLImageElement) => {
        imageElement.style.display = 'none';
        const container = imageElement.closest('.profile-image-container');
        const initialsSpan = container?.querySelector('.profile-initials');
        if (initialsSpan) {
          initialsSpan.classList.remove('hidden');
          initialsSpan.style.display = 'flex';
        }
      };
      
      // Check if image is already loaded and failed
      if (img.complete) {
        if (img.naturalHeight === 0 || img.naturalWidth === 0) {
          showInitials(img);
        }
      } else {
        // Image is still loading, wait for load or error
        img.addEventListener('load', function() {
          // Image loaded successfully, do nothing
        });
      }
      
      // Handle error event
      img.addEventListener('error', function() {
        showInitials(this);
      });
    });

    // Handle deep linking - scroll to specific person if hash is present
    if (window.location.hash) {
      const hash = window.location.hash.substring(1); // Remove the #
      const targetElement = document.getElementById(hash);
      if (targetElement) {
        // Small delay to ensure page is fully loaded
        setTimeout(() => {
          targetElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }, 100);
      }
    }
  });
</script>

