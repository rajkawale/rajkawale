---
import BaseLayout from "../components/BaseLayout.astro";
import { getCollection } from "astro:content";
import ProjectCard from "../components/ui/ProjectCard.astro";
import SmartBackButton from "../components/ui/SmartBackButton.astro";
import PDFModal from "../components/ui/PDFModal.astro";
import PDFModalHandler from "../components/ui/PDFModalHandler.astro";

const allWork = await getCollection("work");
const sortedWork = allWork.sort((a, b) => a.data.priority - b.data.priority);

// Map category to new system (handle both old and new category values)
const getCategory = (category: string) => {
  // Map old categories to new ones
  if (
    category === "founder-led" ||
    category === "shipped" ||
    category === "startup"
  ) {
    return "shipped";
  }
  if (category === "enterprise" || category === "professional") {
    return "professional";
  }
  if (category === "strategy" || category === "casestudy") {
    return "casestudy";
  }
  // Default fallback
  return category;
};

// Filter by new category system
const shippedProjects = sortedWork.filter(
  (item) => getCategory(item.data.category) === "shipped",
);
const professionalWork = sortedWork.filter(
  (item) => getCategory(item.data.category) === "professional",
);
const caseStudies = sortedWork.filter(
  (item) => getCategory(item.data.category) === "casestudy",
);
---

<BaseLayout
  title="Work | Raj Kawale | Product Work & Case Studies"
  description="Product work and case studies including shipped products (RaiTalk, Trinka AI, Madhav Farm), professional engagements (Sinch, Nextech AR, Pernia's Pop-Up Shop), and strategic analyses."
  keywords="product work, case studies, shipped products, professional work, product management portfolio, AI products, SaaS products, e-commerce products"
>
  <main
    class="min-h-screen bg-[radial-gradient(ellipse_at_center,_var(--tw-gradient-stops))] from-slate-800 via-slate-900 to-black text-zinc-300 relative z-10"
    style="padding-top: 150px;"
  >
    <!-- Page Header -->
    <div class="max-w-5xl mx-auto px-6 py-20">
      <div class="mb-16 text-center">
        <h1
          class="text-4xl md:text-5xl font-serif font-bold text-slate-100 mb-4"
        >
          Work<span class="text-gray-500">.</span>
        </h1>
        <p class="text-zinc-300 text-lg font-sans max-w-2xl mx-auto">
          Product work and case studies across shipped products, professional
          engagements, and strategic analyses.
        </p>
      </div>

      <!-- Shipped Products Section -->
      {
        shippedProjects.length > 0 && (
          <section class="mb-12">
            <h2 class="text-3xl font-serif text-slate-100 mb-8">
              Ventures & Products Built
            </h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
              {shippedProjects.map((item) => (
                <ProjectCard project={item} size="medium" />
              ))}
            </div>
          </section>
        )
      }

      <!-- Professional Work Section -->
      {
        professionalWork.length > 0 && (
          <section class="mb-12">
            <h2 class="text-3xl font-serif text-slate-100 mb-8">
              Professional Impact & Deliverables
            </h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
              {professionalWork.map((item) => (
                <ProjectCard project={item} size="medium" />
              ))}
            </div>
          </section>
        )
      }

      <!-- Case Studies Section -->
      {
        caseStudies.length > 0 && (
          <section class="mb-12">
            <h2 class="text-3xl font-serif text-slate-100 mb-8">
              Strategic Analysis & Teardowns
            </h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
              {caseStudies.map((item) => (
                <ProjectCard project={item} size="medium" />
              ))}
            </div>
          </section>
        )
      }
      <div
        class="max-w-[1100px] mx-auto px-5 md:px-12 mt-16 mb-0 border-t border-white/10 pt-8"
      >
        <SmartBackButton />
      </div>
    </div>
  </main>

  <!-- PDF/Document Viewer Modal -->
  <PDFModal />
  <PDFModalHandler />
</BaseLayout>

<style>
  /* Ensure consistent spacing and styling */
  section {
    scroll-margin-top: 150px;
  }
</style>
