---
import BaseLayout from "../components/BaseLayout.astro";
import { getCollection } from "astro:content";
import ProjectCard from "../components/ui/ProjectCard.astro";

import DriveViewer from "../components/ui/DriveViewer.astro";

const allWork = await getCollection("work");

const sortedWork = allWork.sort((a, b) => a.data.priority - b.data.priority);

// Get featured projects for Bento Grid
const sinch = allWork.find(p => p.slug === 'sinch');
const raitalk = allWork.find(p => p.slug === 'raitalk');
const madhavFarm = allWork.find(p => p.slug === 'madhav-farm');

const ventures = sortedWork.filter((item) => item.data.category === "venture");
const enterpriseProjects = sortedWork.filter(
  (item) => item.data.category === "enterprise",
);
const strategyWork = sortedWork.filter(
  (item) => item.data.category === "strategy",
);
---

<BaseLayout
  title="Work | Raj Kawale | Product Work & Case Studies"
  description="Product work and case studies including shipped products (RaiTalk, Trinka AI, Madhav Farm), professional engagements (Sinch, Nextech AR, Pernia's Pop-Up Shop), and strategic analyses."
  keywords="product work, case studies, shipped products, professional work, product management portfolio, AI products, SaaS products, e-commerce products"
>
  <main
    class="min-h-screen bg-[radial-gradient(ellipse_at_center,_var(--tw-gradient-stops))] from-slate-800 via-slate-900 to-black text-zinc-300 relative z-10"
    style="padding-top: 150px;"
  >
    <div class="max-w-[1100px] mx-auto px-5 md:px-12 pb-24">
      <!-- Page Header -->
      <div class="mb-16 text-center">
        <h1
          class="text-4xl md:text-5xl font-serif font-bold text-slate-100 mb-4"
        >
          Work<span class="text-gray-500">.</span>
        </h1>
        <p class="text-zinc-300 text-lg font-sans max-w-2xl mx-auto">
          Product work and case studies across shipped products, professional
          engagements, and strategic analyses.
        </p>
      </div>

      <!-- Featured Work Bento Grid -->
      {(raitalk || sinch || madhavFarm) && (
        <section class="mb-32">
          <div class="mb-8 text-center">
            <h2 class="text-3xl md:text-4xl font-serif font-bold text-slate-100 mb-2">
              Featured Work<span class="text-gray-500">.</span>
            </h2>
            <p class="text-zinc-300 text-base font-sans">
              High-impact outcomes across Enterprise, Venture, and Engineering.
            </p>
          </div>

          <div class="max-w-[1100px] mx-auto grid grid-cols-1 md:grid-cols-3 md:grid-rows-[auto_auto] gap-4">
            
            <!-- Card 1: RaiTalk (Wide Top Left - AI Priority) -->
            {
              raitalk && (
                <div class="group relative md:col-span-2 md:row-span-1 rounded-2xl overflow-hidden bg-gradient-to-br from-indigo-950 via-purple-950 to-black border border-white/10 hover:border-white/20 transition-all duration-500 min-h-[500px] md:min-h-[480px]">
                  <div class="absolute inset-0 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-purple-500/20 via-transparent to-transparent opacity-60 group-hover:opacity-100 transition-opacity duration-500 animate-pulse-slow"></div>
                  <div class="relative z-10 p-8 h-full flex flex-col justify-between">
                    <div>
                      <span class="inline-block w-fit px-2 py-1 mb-3 text-[10px] font-mono font-medium text-purple-300 bg-purple-500/10 border border-purple-500/20 rounded-full">
                        {raitalk.data.badge || raitalk.data.category}
                      </span>
                      <h3 class="text-2xl md:text-3xl lg:text-4xl leading-tight font-serif font-bold text-white mb-4 group-hover:text-purple-100 transition-colors break-words">
                        RaiTalk: Cognitive AI Engine
                      </h3>
                    </div>
                    <div class="mt-auto flex flex-col md:flex-row items-start md:items-end justify-between gap-4">
                      <div>
                        <p class="text-2xl md:text-3xl lg:text-4xl font-bold text-white mb-2 break-words">
                          0 → 1 Product Launch
                        </p>
                      </div>
                      <a
                        href="https://raitalk.rajkawale.com"
                        target="_blank"
                        rel="noopener noreferrer"
                        class="px-6 py-3 rounded-full bg-white/10 hover:bg-white/20 border border-white/20 hover:border-white/40 text-white font-medium text-sm transition-all duration-300 ease-out backdrop-blur-sm hover:shadow-[0_0_20px_rgba(255,255,255,0.3)] flex items-center gap-2 whitespace-nowrap flex-shrink-0"
                        onclick="event.stopPropagation()"
                      >
                        Visit Live App <span class="text-xs">↗</span>
                      </a>
                    </div>
                  </div>
                </div>
              )
            }

            <!-- Card 2: Sinch (Narrow Top Right) -->
            {
              sinch && (
                <button
                  type="button"
                  data-modal-trigger="sinch"
                  data-work-title="Unified Customer Data"
                  data-work-metric="+23% ROI Delivered"
                  data-work-badge={sinch.data.badge || sinch.data.category}
                  data-work-description={sinch.data.description}
                  data-work-tags={JSON.stringify(sinch.data.tags || [])}
                  data-work-category={sinch.data.category}
                  class="group relative md:col-span-1 md:row-span-1 rounded-2xl overflow-hidden bg-gradient-to-br from-slate-900 via-slate-800 to-black border border-white/10 hover:border-white/20 transition-all duration-500 cursor-pointer text-left w-full min-h-[500px] md:min-h-[480px]"
                >
                  <div class="absolute inset-0 bg-[radial-gradient(ellipse_at_top_right,_var(--tw-gradient-stops))] from-blue-500/10 via-transparent to-transparent opacity-50 group-hover:opacity-100 transition-opacity duration-500"></div>
                  <div class="relative z-10 p-8 h-full flex flex-col justify-between">
                    <div>
                      <span class="inline-block px-2 py-1 mb-3 text-[10px] font-mono font-medium text-blue-300 bg-blue-500/10 border border-blue-500/20 rounded-full">
                        {sinch.data.badge || sinch.data.category}
                      </span>
                      <h3 class="text-lg md:text-xl lg:text-2xl leading-tight font-serif font-bold text-white mb-4 group-hover:text-blue-100 transition-colors break-words">
                        Unified Customer Data
                      </h3>
                    </div>
                    <div class="mt-auto">
                      <p class="text-xl md:text-2xl lg:text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-200 to-white tracking-tight break-words">
                        +23% ROI Delivered
                      </p>
                    </div>
                  </div>
                </button>
              )
            }

            <!-- Card 3: Madhav Farm (Wide Bottom) -->
            {
              madhavFarm && (
                <button
                  type="button"
                  data-modal-trigger="madhav-farm"
                  data-work-title="Madhav Farm: Venture Ownership"
                  data-work-metric="8L Vol / 25% Faster Speed"
                  data-work-badge={madhavFarm.data.badge || madhavFarm.data.category}
                  data-work-description={madhavFarm.data.description}
                  data-work-tags={JSON.stringify(madhavFarm.data.tags || [])}
                  data-work-category={madhavFarm.data.category}
                  class="group relative md:col-span-2 md:row-span-1 rounded-2xl overflow-hidden bg-zinc-900 border border-white/10 hover:border-white/20 transition-all duration-500 cursor-pointer text-left w-full min-h-[350px] md:min-h-[320px]"
                >
                  <!-- Subtle Gradient Overlay -->
                  <div class="absolute inset-0 bg-[linear-gradient(to_right,#0596690a_1px,transparent_1px),linear-gradient(to_bottom,#0596690a_1px,transparent_1px)] bg-[size:24px_24px] opacity-20 hover:opacity-10 transition-opacity"></div>
                  <!-- Radial Glow -->
                  <div class="absolute inset-0 bg-[radial-gradient(circle_at_bottom_left,_var(--tw-gradient-stops))] from-emerald-900/40 via-transparent to-transparent opacity-60 group-hover:opacity-100 transition-opacity duration-500"></div>

                  <div class="relative z-10 p-8 h-full flex flex-col md:flex-row md:items-center justify-between gap-6">
                    <div class="flex-1">
                      <span class="inline-block px-2 py-1 mb-2 text-[10px] font-mono font-medium text-emerald-300 bg-emerald-500/10 border border-emerald-500/20 rounded-full">
                        {madhavFarm.data.badge || madhavFarm.data.category}
                      </span>
                      <h3 class="text-xl md:text-2xl lg:text-3xl leading-tight font-serif font-bold text-white mb-4 group-hover:text-emerald-100 transition-colors break-words">
                        Madhav Farm: Venture Ownership
                      </h3>
                    </div>
                    <div class="text-right flex-shrink-0">
                      <p class="text-xl md:text-2xl lg:text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-emerald-200 to-white leading-tight break-words">
                        8L Vol / 25% Faster Speed
                      </p>
                    </div>
                  </div>
                </button>
              )
            }

          </div>
        </section>
      )}

      <!-- Venture Section (Founders) -->
      {
        ventures.length > 0 && (
          <section class="mb-32">
            <div class="mb-8 border-l-4 border-purple-500 pl-4">
              <h2 class="text-3xl md:text-4xl font-serif font-bold text-slate-100">
                Founder & 0→1 Builds
              </h2>
              <p class="text-purple-300 font-mono text-sm mt-1 uppercase tracking-wide">
                End-to-end product engineering. Blank canvas to Revenue.
              </p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-8">
              {ventures.map((item) => (
                <ProjectCard project={item} size="large" />
              ))}
            </div>
          </section>
        )
      }

      <!-- Enterprise Section (Scale) -->
      {
        enterpriseProjects.length > 0 && (
          <section class="mb-32">
            <div class="mb-8 border-l-4 border-blue-500 pl-4">
              <h2 class="text-3xl md:text-4xl font-serif font-bold text-slate-100">
                Enterprise Scale
              </h2>
              <p class="text-blue-300 font-mono text-sm mt-1 uppercase tracking-wide">
                Architectural transformation & Operational efficiency.
              </p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
              {enterpriseProjects.map((item) => (
                <ProjectCard project={item} />
              ))}
            </div>
          </section>
        )
      }

      <!-- Strategy Section (Thinking) -->
      {
        strategyWork.length > 0 && (
          <section class="mb-32 relative">
             <!-- Background Texture for 'Paper' feel -->
            <div class="absolute inset-0 bg-white/5 bg-[radial-gradient(#e5e7eb_1px,transparent_1px)] [background-size:16px_16px] opacity-[0.03] pointer-events-none rounded-xl"></div>
            
            <div class="relative z-10 p-6 md:p-8 rounded-xl border border-white/10 bg-white/5 backdrop-blur-sm">
                <div class="mb-8">
                <h2 class="text-3xl md:text-4xl font-serif font-bold text-slate-100">
                    Product Thinking
                </h2>
                <p class="text-emerald-300 font-mono text-sm mt-1 uppercase tracking-wide">
                    Deep dives into monetization, growth loops, and market strategy.
                </p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                {strategyWork.map((item) => (
                    <ProjectCard project={item} />
                ))}
                </div>
            </div>
          </section>
        )
      }
    </div>
  </main>

  <!-- Drive Viewer Modal -->
  <DriveViewer fileId="" title="Document Viewer" />

  <!-- Work Details Modal -->
  <div id="work-details-modal" class="work-modal fixed inset-0 z-50 hidden items-center justify-center p-4" aria-hidden="true">
    <div class="work-modal-backdrop absolute inset-0 bg-black/80 backdrop-blur-sm" data-modal-close></div>
    <div class="work-modal-content relative z-10 max-w-3xl w-full max-h-[90vh] overflow-y-auto bg-[#020617] border border-white/20 rounded-2xl p-8 md:p-12">
      <button
        type="button"
        class="work-modal-close absolute top-6 right-6 w-10 h-10 flex items-center justify-center rounded-full bg-white/5 hover:bg-white/10 border border-white/20 hover:border-white/40 transition-all duration-300 text-white"
        data-modal-close
        aria-label="Close modal"
      >
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
      <div id="work-modal-body">
        <!-- Modal content will be injected here -->
      </div>
    </div>
  </div>
</BaseLayout>

<style>
  /* Ensure consistent spacing and styling */
  section {
    scroll-margin-top: 150px;
  }

  /* Work Details Modal Styles */
  .work-modal {
    animation: fadeIn 0.3s ease-out;
  }

  .work-modal-backdrop {
    animation: fadeIn 0.3s ease-out;
  }

  .work-modal-content {
    animation: slideUp 0.3s ease-out;
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }

  @keyframes slideUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .work-modal-close {
    transition: all 0.3s ease-out;
  }

  .work-modal-close:hover {
    box-shadow: 0 0 15px rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.5);
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    // Work Details Modal System
    const modal = document.getElementById('work-details-modal');
    const modalBody = document.getElementById('work-modal-body');
    const modalTriggers = document.querySelectorAll('[data-modal-trigger]');
    const modalCloses = document.querySelectorAll('[data-modal-close]');

    function openModal(trigger) {
      const title = trigger.getAttribute('data-work-title');
      const metric = trigger.getAttribute('data-work-metric');
      const badge = trigger.getAttribute('data-work-badge');
      const description = trigger.getAttribute('data-work-description');
      const tagsJson = trigger.getAttribute('data-work-tags');
      const category = trigger.getAttribute('data-work-category');
      
      if (!title || !metric) return;

      const tags = tagsJson ? JSON.parse(tagsJson) : [];

      modalBody.innerHTML = `
        <div class="space-y-6">
          <div>
            <span class="inline-block px-3 py-1 mb-4 text-xs font-mono font-medium ${
              category === 'enterprise' 
                ? 'text-blue-300 bg-blue-500/10 border border-blue-500/20' 
                : 'text-emerald-300 bg-emerald-500/10 border border-emerald-500/20'
            } rounded-full">
              ${badge || ''}
            </span>
            <h2 class="text-3xl md:text-4xl font-serif font-bold text-white mb-4">
              ${title}
            </h2>
            <div class="mb-6">
              <p class="text-4xl md:text-5xl font-bold ${
                category === 'enterprise'
                  ? 'text-transparent bg-clip-text bg-gradient-to-r from-blue-200 to-white'
                  : 'text-transparent bg-clip-text bg-gradient-to-r from-emerald-200 to-white'
              }">
                ${metric}
              </p>
            </div>
          </div>
          
          <div class="border-t border-white/10 pt-6">
            <h3 class="text-lg font-serif font-bold text-white mb-3">Problem</h3>
            <p class="text-zinc-300 leading-relaxed mb-6">
              ${description || 'Details coming soon...'}
            </p>
          </div>

          <div class="border-t border-white/10 pt-6">
            <h3 class="text-lg font-serif font-bold text-white mb-3">Solution</h3>
            <p class="text-zinc-300 leading-relaxed mb-6">
              ${description || 'Details coming soon...'}
            </p>
          </div>

          <div class="border-t border-white/10 pt-6">
            <h3 class="text-lg font-serif font-bold text-white mb-3">Impact</h3>
            <p class="text-zinc-300 leading-relaxed">
              ${metric}
            </p>
          </div>

          ${tags && tags.length > 0 ? `
            <div class="border-t border-white/10 pt-6">
              <h3 class="text-lg font-serif font-bold text-white mb-3">Tech Stack</h3>
              <div class="flex flex-wrap gap-2">
                ${tags.map(tag => `
                  <span class="px-3 py-1 text-xs font-mono font-medium bg-zinc-950/50 border border-zinc-800/50 rounded text-zinc-300">
                    ${tag}
                  </span>
                `).join('')}
              </div>
            </div>
          ` : ''}
        </div>
      `;

      modal.classList.remove('hidden');
      modal.classList.add('flex');
      document.body.style.overflow = 'hidden';
    }

    function closeModal() {
      modal.classList.add('hidden');
      modal.classList.remove('flex');
      document.body.style.overflow = '';
    }

    // Attach event listeners
    modalTriggers.forEach(trigger => {
      trigger.addEventListener('click', () => {
        openModal(trigger);
      });
    });

    modalCloses.forEach(close => {
      close.addEventListener('click', closeModal);
    });

    // Close on Escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && !modal.classList.contains('hidden')) {
        closeModal();
      }
    });
  });
</script>
